## 题目分析
题目要求计算最合适的各组BMI区间，使得NIPT的时机最合适，且风险最小、测量误差最小。因而我们需要在每位孕妇所有NIPT样本中首次y染色体浓度>=4%的相关数据，以判别MBI同孕周的关联，并探讨唯一比对的读段数、被过滤掉读段数的比例、重复读段的比例、在参考基因组上比对的比例、Y染色体的Z值对y染色体浓度的影响。  

## 数据预处理
从...中抽取各孕妇样本中首次y染色体浓度>=4%的相关数据共267行。  

## 建模过程

### 1. 聚类分析
采用DBSCAN+局部加权回归的方案。

1.1 DBSCAN
鉴于传统K-means算法对噪声敏感且无法自动识别簇数量的缺陷，本研究采用基于密度的空间聚类算法（DBSCAN）对数据进行聚类分析。该算法基于“簇是数据空间中密集区域”的假设，能够识别任意形状的簇并有效分离噪声点。

#### 数学模型定义
- ε-邻域： 对于给定对象 $p$，其 $ε$-邻域定义为以 $p$ 为中心、以 $ε$ 为半径的圆形区域内的对象集合，记为 $N_ε(p) = \{q ; | ; \text{dist}(p, q) ≤ ε\}$。
- 核心对象： 如果对象 $p$ 的 $ε$-邻域内至少包含 $MinPts$ 个对象（包括$p$本身），即 $|N_ε(p)| ≥ MinPts$，则称 $p$ 为核心对象。
- 直接密度可达： 如果对象 $p$ 在 $q$ 的 $ε$-邻域内，且 $q$ 是一个核心对象，则称对象 $p$ 是从 $q$ 直接密度可达的。
- 密度可达： 如果存在一个对象链 $p_1, p_2, ..., p_n$，其中 $p_1 = q$, $p_n = p$，且对于 $p_{i+1}$ 是从 $p_i$ 直接密度可达的，则称 $p$ 是从 $q$ 密度可达的。
- 密度相连： 如果存在一个对象 $o$，使得对象 $p$ 和 $q$ 都是从 $o$ 密度可达的，则称 $p$ 和 $q$ 是密度相连的。  
#### 算法聚类过程
- 算法遍历所有未访问的点。
- 如果一个点 $p$ 是核心对象，则以其为基础创建一个新的簇，并迭代地收集所有从该点密度可达的对象，形成一个簇。
- 如果一个点不是核心对象，且不属于任何簇，则将其标记为噪声（或边界点）。
参数选择： 参数 $ε$ 和 $MinPts$ 通过绘制 **k-distance图（已绘制）** 并结合问题背景进行确定.在 DBSCAN 聚类算法中，两个核心参数是邻域半径 ϵ 和最小点数 k = MinPts。我们首先根据经验法则，将 k 设定为 3，该值能够有效确保聚类只在密度高的区域形成。然后，我们通过绘制 k-距离图来确定最佳的 ϵ 值。在该图中，k 被设定为 min_pts，图中的**拐点（elbow point）**所对应的距离即为最优 ϵ。  

1.2 局部加权回归（**已绘制**）
由预处理数据散点图可知，散点分别聚集在多个区间，因而采用该方法最合适。同时考虑到有|Z| >= 3的异常点要处理，我们在对应的点增加了权重使模型趋向于绕开异常点以降低其于数据中的浓度，可使求解结果风险尽量小。  

#### 局部加权回归 (LOESS) 在二维数据中的特点：
- 优点：
在每个预测点用邻域数据拟合局部低阶多项式，非常适合处理“局部有聚集”的情况。  
不需要假设全局函数形式，能够拟合复杂、非均匀的曲面。  
灵活捕捉局部变化（比如数据云团、簇状分布）。  
- 缺点：
计算量大：二维局部拟合比一维更耗时。  
边界区域或数据稀疏区域，拟合结果不稳定。  
参数选择（邻域半径、权重函数）对结果敏感。  
不会产生全局解析模型，解释性差。  

#### 核心思想和描述
Loess 的核心思想是** 局部拟合 **。它在每个预测点上，都用一个独立的加权线性回归或加权二次回归来拟合该点附近的局部数据。
你可以这样描述它的基本原理：
> “局部加权回归（Loess）是一种强大的非参数回归方法，它不依赖于任何预设的函数形式来描述变量之间的关系。其核心思想是，在数据空间中，每个预测点 $x_i$ 的拟合值 $\hat{y}_i$ 仅由其附近的局部数据点决定。
> **该方法通过为每个局部数据点赋予不同的权重来完成拟合：** 距离预测点 $x_i$ 越近的数据点，其权重越高；距离越远，权重越低。通过这种方式，Loess 能够灵活地捕捉数据的非线性趋势和局部变化，生成一条平滑的拟合曲线。”  

#### 数学方程
虽然没有单一的全局方程，但 Loess 的局部拟合过程可以用数学形式来描述。对于每一个预测点 $x$，Loess 的拟合值 $\hat{y}$ 是通过解决以下加权最小二乘问题得到的：
$$\hat{y}(x) = \arg\min_{\beta_0, \beta_1} \sum_{i=1}^{n} w_i(x) \cdot (y_i - (\beta_0 + \beta_1 x_i))^2$$
其中：
* $n$ 是数据点的总数。
* $(x_i, y_i)$ 是原始数据点。
* $(\beta_0, \beta_1)$ 是**局部**线性回归的系数。
* $w_i(x)$ 是**权重函数**，它取决于数据点 $x_i$ 与预测点 $x$ 之间的距离。常用的权重函数是**三次权重函数（Tricube Weight Function）**，其定义为：
$$w(d) = \begin{cases} (1 - d^3)^3 & \text{if } d < 1 \\ 0 & \text{if } d \ge 1 \end{cases}$$
这里的 $d$ 是数据点 $x_i$ 到预测点 $x$ 的标准化距离。  

### 2. 误差分析
2.1 熵权法+topsis
将唯一比对的读段数、被过滤掉读段数的比例、重复读段的比例、在参考基因组上比对的比例四个指标进行标准化求出综合评分（未实现打表以进行各个指标的横向比较）  
2.2 建立回归模型
为确定应当使用的回归方法，首先要明确各项指标的分布情况（**如图**）：  
从图中可以看出，除了Y染色体的Z值可能近似服从正态分布外，其他几个关键指标（如唯一比对的读段数、被过滤掉读段数的比例等）都呈现出明显的偏态分布。
- 线性回归的局限性：标准的多元线性回归模型假设残差（模型的误差）是正态分布的。当自变量本身严重偏斜时，这会使模型的假设难以满足，可能导致结果不准确，甚至会影响变量系数的解释。
- 非线性关系：这些偏态分布也暗示着，这些指标与 Y 染色体浓度之间的关系很可能不是简单的线性关系。

因此，我们不能直接使用标准的多元线性回归。可以采用*数据变换+多元线性回归*的方案（**已绘制**），发现效果不理想：  
- 左边的残差图显示了一个非常明显的漏斗形模式：随着预测值增大，残差的波动范围也越来越大。这被称为异方差性（Heteroscedasticity）。这违反了线性回归模型的一个核心假设，即残差的方差是恒定的。
- 右边的预测值与实际值散点图也验证了这一点。数据点并没有紧密地分布在 y=x 对角线附近，而是呈现出一种扇形发散的趋势。当预测值很低时，模型的表现还不错，但当预测值很高时，预测值与实际值之间的偏差变得非常大。  
*论文中如何解释*
- 承认问题：明确指出多元线性回归模型的诊断图显示了异方差性。这意味着模型的预测误差会随着 Y染色体浓度 的预测值增大而增大。
- 解释原因：分析为什么会出现这种现象。最可能的原因是：
- 非线性关系：Y染色体浓度 与其他变量之间的关系不是简单的线性关系。
- 数据本身的特性：Y染色体浓度 本身是一个百分比或比例，它的波动范围可能与均值相关，而不是恒定的。
此外我也尝试了广义线性模型（**已绘制**）。  
*论文中描述改进*
- “为探究各因素对Y染色体浓度的影响，我们首先构建了基于检测孕周、孕妇BMI和TOPSIS评分的多元线性回归模型。然而，对模型残差图（图A）进行诊断分析后发现，模型的残差呈现出明显的漏斗形发散模式。这表明模型存在异方差性，即随着预测值的增大，预测误差也随之增大，违背了线性回归模型关于残差方差恒定的关键假设。因此，该模型的系数估计和统计显著性（p值）均不可信，无法为我们的结论提供稳健支持。”
- “为解决多元线性回归模型的异方差性问题，我们转向使用广义线性模型（GLM）。考虑到Y染色体浓度作为比例数据的特性，我们选择了Gamma分布作为误差分布，并使用对数（Log）链接函数进行模型拟合。这种选择能够更好地捕捉Y染色体浓度数据中存在的非线性关系和方差随均值变化的特点。”
- “从GLM的残差诊断图（图B）可以看出，模型的残差点更加均匀、随机地分布在零线上下，原有的漏斗形模式已被有效消除。这证明GLM成功地解决了模型的异方差性问题，使得模型的系数估计和统计推断更加稳健和可靠。因此，后续分析将基于该GLM模型的结果进行。”
